<div class="card-container">
  <div class="card">
    <turbo-frame id="<%= dom_id @booking %>">
      <h2 class="title px-4 pt-4">Update Booking</h2>
      <div class="m-4">
        <%= form_with(model: [ :admins, @booking], local: true, data: { turbo: false }, class: "flex flex-col justify-center") do |f| %>
          <% if @booking.errors.any? %>
            <div id="error_explanation" class="flex flex-col items-center">
              <h2 class="text-text-color/50"><%= pluralize(@booking.errors.count, "error") %>:</h2>
              <ul class="text-error">
                <% @booking.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>
          <div class="flex flex-col gap-4 w-full">
            <div>
              <h3 class="title">Booking Details</h3>
              <div class="input-container">
                <%= f.label "Room Number", class: "input-label" %>
                <% available_rooms = @hotel.rooms.where(status: 'available') %>
                <% current_room = @booking.room %>
                <%= f.collection_select :room_id, (available_rooms + [current_room]).uniq, :id, :room_number, { selected: current_room.id },
                                        class: "input-field" %>
              </div>
              <div class="input-container">
                <%= f.label :checkin_date, class: "input-label" %>
                <%= f.text_field :checkin_date, value: @booking.checkin_date&.strftime("%Y-%m-%d"),
                                 data: { controller: "flatpickr", flatpickr_min_date: Date.today.to_s, flatpickr_date_format: "Y-m-d"},
                                 class: "input-field", placeholder: "YYYY-MM-DD" %>
              </div>

              <div class="input-container">
                <%= f.label :checkout_date, class: "input-label" %>
                <%= f.text_field :checkout_date, value: @booking.checkout_date&.strftime("%Y-%m-%d"),
                                 data: { controller: "flatpickr",flatpickr_min_date: Date.tomorrow.to_s, flatpickr_date_format: "Y-m-d", },
                                 class: "input-field", placeholder: "YYYY-MM-DD" %>
              </div>

              <div class="input-container">
                <%= f.label :num_of_adult, class: "input-label" %>
                <%= f.number_field :num_of_adult, class: "input-field", placeholder: "Number of Adults" %>
              </div>

              <div class="input-container">
                <%= f.label :num_of_children, class: "input-label" %>
                <%= f.number_field :num_of_children, class: "input-field", placeholder: "Number of Children" %>
              </div>
              <div class="input-container">
                <%= f.label :payment_status, class: "input-label" %>
                <%= f.select :payment_status, Booking.payment_statuses.keys.map { |d| [d.humanize, d] }, class: "input-field" %>
              </div>

              <div class="input-container">
                <%= f.label :total_amount, class: "input-label" %>
                <%= f.number_field :total_amount, class: "input-field" %>
              </div>
            </div>
            <hr>
            <div>
              <%= f.fields_for :guest do |guest_form| %>
                <h3 class="title">Guest Details</h3>
                <div class="input-container">
                  <%= guest_form.label :first_name, class: "input-label" %>
                  <%= guest_form.text_field :first_name, class: "input-field", placeholder: "First Name" %>
                </div>

                <div class="input-container">
                  <%= guest_form.label :last_name, class: "input-label" %>
                  <%= guest_form.text_field :last_name, class: "input-field", placeholder: "Last Name" %>
                </div>

                <div class="input-container">
                  <%= guest_form.label :contact_no, class: "input-label" %>
                  <%= guest_form.text_field :contact_no, class: "input-field", placeholder: "Contact Number" %>
                </div>

                <div class="input-container">
                  <%= guest_form.label :email, class: "input-label" %>
                  <%= guest_form.email_field :email, class: "input-field", placeholder: "example@gmail.com" %>
                </div>

                <div class="input-container">
                  <%= guest_form.label :country, class: "input-label" %>
                  <%= guest_form.text_field :country, class: "input-field", placeholder: "Country" %>
                </div>

                <div class="input-container">
                  <%= guest_form.label :region, class: "input-label" %>
                  <%= guest_form.text_field :region, class: "input-field", placeholder: "Region/State" %>
                </div>

                <div class="input-container">
                  <%= guest_form.label :city, class: "input-label" %>
                  <%= guest_form.text_field :city, class: "input-field", placeholder: "City" %>
                </div>
              <% end %>
            </div>
          </div>

          <hr class="bg-primary-regular h-0.5">
          <div class="flex items-center mt-4 gap-5">
            <%= f.submit "Update", class: "btn" %>
            <% if @booking.persisted? %>
              <%= link_to "Cancel", admins_booking_path(@booking), class: "btn", data: { turbo_frame: "_top"} %>
            <% else %>
              <%= link_to "Cancel", admins_bookings_path, class: "btn", data: { turbo_frame: "_top"} %>
            <% end %>
          </div>
        <% end %>
      </div>
    </turbo-frame>
  </div>
</div>
